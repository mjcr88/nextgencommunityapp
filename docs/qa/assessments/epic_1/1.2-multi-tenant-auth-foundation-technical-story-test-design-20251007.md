# Test Design: Story 1.2 - Multi-Tenant & Auth Foundation

Date: 2025-10-07
Reviewer: Quinn (Test Architect)

## Test Strategy Summary

This story is critical for security and data isolation. Testing must focus heavily on **Security and Data Integrity**, specifically validating Row Level Security (RLS) and the core authentication flow.

## Test Scenarios (Acceptance Criteria Traceability)

| Test Case ID | Test Type | Description | Acceptance Criteria | Priority |
| :--- | :--- | :--- | :--- | :--- |
| **TC-1.2.1** | Security/RLS (Negative) | Verify a user from Tenant A cannot query data belonging to Tenant B. | AC 1 (RLS) | Critical |
| **TC-1.2.2** | Security/RLS | Verify a user can only query data belonging to their own Tenant ID. | AC 1 (RLS) | Critical |
| **TC-1.2.3** | Security/Auth | Verify successful login with valid credentials (email/password). | AC 2 | High |
| **TC-1.2.4** | Security/Auth (Negative) | Verify login fails with invalid credentials (wrong password/email). | AC 2 | High |
| **TC-1.2.5** | Integration | Verify Server Actions correctly use the configured Supabase client and respect RLS. | AC 4 | High |
| **TC-1.2.6** | Data | Verify `tenants` and `users` tables exist and have initial RLS policies applied. | AC 1 | Critical |
| **TC-1.2.7** | Data | Verify initial seed data for the first tenant and super admin user is present. | AC 3 | Medium |

## Test Environment Requirements

- Dedicated Supabase instance with RLS enabled.
- Test data including at least two tenants (Tenant A and Tenant B) and users assigned to each.

## Test Data Requirements

- User A (Tenant A), User B (Tenant B), Super Admin (Tenant A).
- Sample data rows tagged with Tenant A and Tenant B IDs.

## Test Automation Strategy

- **Unit/Integration Tests:** Automated tests for Supabase client configuration and Server Action data access.
- **Security Tests:** Dedicated RLS tests (e.g., using pgTAP or custom SQL scripts) to verify policy enforcement directly at the database level.
