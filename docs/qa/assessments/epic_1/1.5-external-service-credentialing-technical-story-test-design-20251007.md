# Test Design: Story 1.5 - External Service Credentialing

Date: 2025-10-07
Reviewer: Quinn (Test Architect)

## Test Strategy Summary

This story is highly sensitive due to the handling of external API keys. Testing must focus heavily on **Security and Integration Integrity**, ensuring secrets are protected and external communication is secure.

## Test Scenarios (Acceptance Criteria Traceability)

| Test Case ID | Test Type | Description | Acceptance Criteria | Priority |
| :--- | :--- | :--- | :--- | :--- |
| **TC-1.5.1** | Security | Verify API keys are stored securely in Vercel Secrets and are not exposed in client-side code or logs. | AC 1 | Critical |
| **TC-1.5.2** | Security/Integration | Verify the Next.js API route successfully validates the n8n webhook secret. | AC 2 | High |
| **TC-1.5.3** | Integration | Verify server-side components can successfully access and utilize the OpenAI and Telegram credentials for initial connection tests. | AC 3 | High |
| **TC-1.5.4** | Security (Negative) | Verify the webhook endpoint rejects requests with invalid or missing signatures. | AC 2 | High |
| **TC-1.5.5** | Security (Negative) | Verify that committing secrets to source control is blocked (if pre-commit hooks are used). | N/A (Risk Mitigation) | Medium |
| **TC-1.5.6** | Operational | Verify monitoring is in place to alert if external service connections fail (e.g., due to expired keys). | N/A (Risk Mitigation) | Medium |

## Test Environment Requirements

- Vercel project configured with necessary secrets.
- Test n8n instance or mock service capable of sending signed webhooks.
- Test OpenAI and Telegram accounts/keys.

## Test Data Requirements

- Valid and invalid webhook signatures.
- Valid and revoked API keys.

## Test Automation Strategy

- **Security Tests:** Static analysis tools to check for hardcoded secrets. Integration tests to verify webhook signature validation logic.
- **Integration Tests:** Automated tests to verify successful connection and basic functionality with external services.
